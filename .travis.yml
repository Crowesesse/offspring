language: python
sudo: false

branches:
  only:
    - master

python:
  - 2.7
  - 3.5
  - 3.6
  - pypy

install:
  - pip install --upgrade pytest pytest-mock pytest-cov flake8
  - pip install -e .

script:
  - if [ "${TRAVIS_PULL_REQUEST}" == "true" ] && [ -z "$(git diff origin/master setup.py | grep '\+.*version=')" ]; then echo "Bump version in setup.py!"; exit 1; fi
  - flake8 src/ tests/
  - py.test -v --cov=./src tests/

after_success:
  - bash <(curl -s https://codecov.io/bash)

deploy:
  provider: pypi
  user: borgstrom
  password:
    secure: "nR9/vEm+CUy+PwjJvlAatoCnpOa5YFBWgEE5lId89ne0NdTj6A+gh2X2LpK9gK0jxd3RSX+2+tFdleMdRZMrTvdn0CYVvTfTWaYF1iw2iiOPVkV+sg7v+YfJkm2fqyDcdPTctxAHs+xVy2F/ttOuwthBpSWTpxZ6vKn5S3XX7DhOaj1bvMaZTuZtWSZvn9U7KUORFDxN4CcRrhamjE2IW8xe3yoTjZyikPSCEj7Ic6th7I7CX8ink+V2Wa7O1fXq5U1YuUFJv7NceCFmQHjG5jXO8EyabMV1EP4yb4kowdIgIZE2GEmZUO2W1fYmf0MqBnq3oDTRswlAdNaO1xmgRImCfyEno5IhZ1INKOot9KCyQ7syqZB5fNQpPq/5qr8rmjoEIaIfdBz4gSUVV6Gg0VkKsZLsUKTziTVuUSuR0iVf0R6ZJfD+j2Jrx1cFoNFg42X8L/A4gp7+2vEQneSu93PKWVOHKWjN0YZBi9rALeTKQErQmtLuAqsdzeoDnjuOIYDo3NQfbdtI4VMQeVj0f0NDPycwRUppv/ERow3UGjPI6dhu1nhatK2JJP7DmKLj9lnAifqKKpGz5U1AKteHYafD5ghqvuhD/JVBU8JL87Lvb+PzicyiPKNW9MITfXJgQa4zs+Vc9kYWIBtsWu8V9oH+GEBVZ5NSnrH0stWMMUs="
  on:
    branch: master
  distributions: "sdist bdist_wheel"
