language: python
sudo: false

branches:
  only:
    - master

python:
  - 2.7
  - 3.5
  - 3.6
  - pypy

install:
  - pip install --upgrade pytest pytest-mock pytest-cov flake8
  - pip install -e .

script:
  - if [ "${TRAVIS_PULL_REQUEST}" == "true" ] && [ -z "$(git diff origin/master setup.py | grep '\+.*version=')" ]; then echo "Bump version in setup.py!"; exit 1; fi
  - flake8 src/ tests/
  - py.test -v --cov=./src tests/

after_success:
  - bash <(curl -s https://codecov.io/bash)

deploy:
  provider: pypi
  user: borgstrom
  password:
    secure: cyA1ocHKb6Epk20drSGS0QqpQn2MGQV8rs6CJtPN50k+L+8UwwDPPQG+eustW5rsOccQDF21SzPftiFsqfdjBIWrlVX1yHmSf2Dmczd+WWXt/ApK2SXDkyRyqvC7VfaRCinsHXRWw8svU2PcDDEO6nm3CulQ6IC0uPo69eVAAa0G6VFL2Al9hMOGebL1eVGwld57bE666oR4p/vI2p43MzT3lP8Nvm1CNs5IiRPt4N6jo6DwO7BrzVSmEa9Si+bTKx6s+XL4wmYsgSk9mq/7YYrk2DbqXio2Xz2YWnkO1PCY/iCKqADKwydYIwT+9hZDxvMooAUIzieTJNgmyhur1bKB3v4Xzpwr5VmmGeYBHTFHP3Vztg1YwUgn/KnLu0ya7yRbsTN/qprS2CUQhkVneWQrmsKQpxo7XALXNq9BKxfSLahehhbVijNfrzKjQWFCnCC49ORQDVPxyzMqgtg6OsnAjNfvwdHc28AxiRlcc9oFVL0XPrMW17wROGcxvmnB3lzevAnn5h9T0DJI+Qc2s383yb6Xo3/JkRk8xC7h+KUzfG1fQZ/rQh00I6BufxNYxqGLD8jEhRou4E65imtIsh7/BPCiVmycyMIjLmrZUJ+6+6jtJHYtftJnyOOZ9mfiJ1/gcWpa41kJZE/0NClM09xtImWBd6fjLpt+xnl20r0=
  on:
    branch: master
  distributions: "sdist bdist_wheel"
