language: python
sudo: false

branches:
  only:
    - master

python:
  - 2.7
  - 3.5
  - 3.6
  - pypy

install:
  - pip install --upgrade pytest pytest-mock pytest-cov flake8
  - pip install -e .

script:
  - if [ "${TRAVIS_PULL_REQUEST}" == "true" ] && [ -z "$(git diff origin/master setup.py | grep '\+.*version=')" ]; then echo "Bump version in setup.py!"; exit 1; fi
  - flake8 src/ tests/
  - py.test -v --cov=./src tests/

after_success:
  - bash <(curl -s https://codecov.io/bash)

deploy:
  provider: pypi
  user: borgstrom
  password:
    secure: "EF0lR0DdtJTYh5+y2jN6j8StoCM1p7zsumU1UoGTRA9mhRhA48pLX1G002FF5TzCBz3Pgyb5xgbKZAMhe05ijKOsPQG2wJQEByAkN1dxQhHheKNZYQlx3BIOinZqoRUd35eaRVss/wjTVUx/nfPghYCmmNQ74+tsIrerU1jEq8UstvGW1+NAkKkPU56vxLRB7vp7M6gT14ilWmtgqha9ntw2eRCdoB1XSJrC1AyWT5pXPWoaqUIsbIGSeXLjEMVKlz24KVAPuuwGFTNBU1kaQMAj8JmAaxw7Jr5ntZ3HHb6kercTJ+KPagD7mW4R2fxpZNnKSyYCL9nNcKAQ0hXHnMha8c6kudTF3LfbAE9UVkTDhu4b995JiTUxmXc5N3vAihpbCFWxVNypKim6dqjKFQwSjGRDaxTEm9WU+5lAi+knPvZDoBaWVAlRYliqReUijAZnTLVkEHr6wdmJKM3stqI+S2jfNzlV/8HXGYfv++6QvPNevCPLlX8gFjLElDh5C8B+LRbPWkd4zIDtJELFGfg9AV86RU8+Z/txCaIiSHUXDfeYLJ7nydGXl1D5oNwxxEJw/wDkE9SyOvdUUxzTV0vB++3pk4yqjH6Qe5s3sftaLZAbQT/wfuEMuKRUXFKd860c0VOiCDBHoJFB4Vk0G95y6qhzbAaHelpvMpzuUw0="
  on:
    branch: master
  distributions: "sdist bdist_wheel"
